{
	"nodeid": "transform_field_replace",
	"title": "Search and Replace",
	"type": "transform",
	"subtype": "string manipulation",
	"description": "Search and replace a string.",
	"scripts": {
		"hello": "out.say('news', 'You added a node'); ",
        "bye": "out.say('news', 'Deleted node. Bye!'); ",
        "init":
        [
			"out.say('progress', 'Starting replacing..');",
			"/* set output field */",
			"out.field = context.node.params.in_field + context.node.params.suffix; "
		],
		"run": 
		[
			"var reg = new RegExp(context.node.settings.search, 'g'); ",
            "var val = context.doc[context.node.params.in_field]; ",
			"if( typeof val === 'string') {",
			"    out.value = val.replace(reg, context.node.settings.replace);",
			"} else if (val.constructor.name === 'Array') {",
			"    out.value = []; ",
			"    for (i = 0; i < val.length; i++) { ",
			"        out.value.push(val[i].replace(reg, context.node.settings.replace)); ",
			"    }",
			"}"
		],
		"finish": "out.say('finish', 'Replace done!');"
	},
	
	"views": {
		"params":
		[
			"<label>Note title</label> <input name='title'/>",
			"<label>in field:</label> <input class='dynamic_field' name='in_field'/>",
			"<label>output field suffix:</label> <input name='suffix'/ value='_replaced'>"
		],
		"settings":
		[
			"<label>find this:</label> <input name='search'/>",
			"<label>replace with this:</label> <input name='replace'/>"
		]
	}
}
