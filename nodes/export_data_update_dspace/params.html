
<label>Choose DSpace REST API url or write url below.</label>
<select id="export-data-dspace-update_url_pre" name="url_pre">
	<option value="">predefined servers</option>
	<option value="http://siljo.lib.jyu.fi:8080/rest">http://siljo.lib.jyu.fi:8080/rest</option>
	<option value="http://demo.dspace.org/rest">http://demo.dspace.org/rest</option>
</select>

<label>DSpace URL</label>
<input id="export-data-dspace-update_url" placeholder="https://demo.dspace.org/rest/" name="url" required />
<button id="export-data-dspace-update_test">Fetch fields</button>
<div id="export-data-dspace-update_status"></div>

<div id="export-data-dspace_hidden" style="display:none">
	<select id="export-data-dspace-update_field_sel" name="original_field">
		<option value="" selected disabled>Choose</option>
	</select>

	<label>write response here</label>
	<input type="text" name="out_field" value="update_response"/>
</div>




<script>

var field_select = $("#export-data-dspace-update_field_sel");
var field_div = $("#export-data-dspace_hidden");
var d_status = $("#export-data-dspace-update_status");

// GET FIELD LIST
function fetchFields (url) {
	
	$.getJSON("/proxy?url=" + url + "/registries/schema", function (data) {
		if(data.error)
			alert(data.error);
		else {
			var html = "";
			data.forEach(function(schema) {
				schema.metadataFields.forEach(function(field) {
					html += "<option value='"+field.name+"'>" + field.name + "</option>"; 
				})
			}) 

			field_select.empty();
			field_select.append(html);
			field_div.show();
			d_status.empty().append("Fields fetched! Choose field below.");
		}
	})
}
	
// GET FIELDS BUTTON HANDLER
$("#export-data-dspace-update_test").click(function (e) {

	var url = $("#export-data-dspace-update_url").val();
	if(url == "") {
		alert("Set the rest api url of DSpace");
		return;
	}
		
	d_status.empty().append("<h4>Fetching from " +url+" </h4>");
	field_select.empty();
	fetchFields(url);				
})	

// CHOOSE SERVER HANDLER
$("#export-data-dspace-update_url_pre").change(function() {
	var url = $("#export-data-dspace-update_url_pre :selected").text();
	$("#export-data-dspace-update_url").val(url);
	field_div.hide();
	field_select.empty();
});

</script>
