
<label>Choose DSpace REST API url or write url below.</label>
<select id="export_data_dspace_update_url_pre" name="url_pre">
	<option value="">predefined servers</option>
	<option value="http://siljo.lib.jyu.fi:8080/rest">http://siljo.lib.jyu.fi:8080/rest</option>
	<option value="http://demo.dspace.org/rest">http://demo.dspace.org/rest</option>
</select>

<label>DSpace URL</label>
<input id="export_data_dspace_update_url" placeholder="https://demo.dspace.org/rest/" name="url" required />
<button id="export_data_dspace_update_test">Test</button>
<div id="export_data_dspace_update_status"></div>

<label id="ff">Choose field</label>
<select id="export_data_dspace_update_field_sel" name="original_field">
    <option value="" selected disabled>Field to be updated</option>
</select>

<label>replace with this</label>
<input class="dynamic_field" name="update_field"/>

<label>set language from this field (optional)</label>
<input class="dynamic_field" name="language_field"/>

<label>write response here</label>
<input type="text" name="out_field" value="update"/>



<script>

// GET FIELD LIST
function fetchSchemas (url) {
	var sel = $("#export_data_dspace_update_field_sel");
	
	$("#ff").text("Fetching field data...");
	$.getJSON("/proxy?url=" + url + "/registries/schema", function (data) {
		if(data.error)
			alert(data.error);
		else {
			var html = "";
			data.forEach(function(schema) {
				schema.metadataFields.forEach(function(field) {
					html += "<option value='"+field.name+"'>" + field.name + "</option>"; 
				})
			}) 

			$(sel).empty();
			$(sel).append(html);
			$(sel).show();
		}
	})
}
	
// TEST
$("#export_data_dspace_update_test").click(function (e) {

	var url = $("#export_data_dspace_update_url").val();
	if(url == "") {
		alert("Set the rest api url of DSpace");
		return;
	}
		
	$("#export_data_dspace_update_status").empty().append("<h4>Testing " +url+" </h4>");

	$.getJSON("/proxy?url=" + url + "/status", function (data) {
		if(data.okay) {
			$("#export_data_dspace_update_status").empty().append("<h4 class='good'>Server good!</h4>");
		} else {
			alert("API did not respond");
			$("#export_data_dspace_update_status").empty().append("<h4 class='bad'>Server problem: "+url+"</h4>");
		}

	})				
})	

	
$("#export_data_dspace_update_url_pre").change(function() {
	var url = $("#export_data_dspace_update_url_pre :selected").text();
	$("#export_data_dspace_update_url").val(url);
	fetchSchemas(url);
});


$("#export_data_dspace_update_field_sel").change(function() {
	alert("meta");
});




</script>
