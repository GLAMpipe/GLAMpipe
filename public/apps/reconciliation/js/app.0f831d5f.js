(function(t){function e(e){for(var a,c,i=e[0],s=e[1],u=e[2],d=0,f=[];d<i.length;d++)c=i[d],Object.prototype.hasOwnProperty.call(r,c)&&r[c]&&f.push(r[c][0]),r[c]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a]);l&&l(e);while(f.length)f.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],a=!0,i=1;i<n.length;i++){var s=n[i];0!==r[s]&&(a=!1)}a&&(o.splice(e--,1),t=c(c.s=n[0]))}return t}var a={},r={app:0},o=[];function c(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=t,c.c=a,c.d=function(t,e,n){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)c.d(n,a,function(e){return t[e]}.bind(null,a));return n},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var l=s;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.error?n("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e(),n("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"info"}},[n("b-navbar-brand",{attrs:{href:""}},[t._v("Reconciliation matching for "),n("b",[t.project?n("span",[t._v(t._s(t.project.title)+": "+t._s(t.project.collection.title))]):t._e()])]),n("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),n("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[n("b-navbar-nav",{staticClass:"ml-auto"},[n("b-navbar-nav")],1)],1)],1),n("b-row",[n("b-col",{staticClass:"sideBar",attrs:{cols:"3"}},[n("b-card",[n("p",[t._v("Choose best match and click select.")]),n("div",[n("b-form-checkbox",{attrs:{id:"checkbox-1",name:"checkbox-1",value:"yes","unchecked-value":"no"},model:{value:t.show_only_non_matched,callback:function(e){t.show_only_non_matched=e},expression:"show_only_non_matched"}},[t._v(" Show only non-matched ")])],1)])],1),n("b-col",{attrs:{cols:"9"}},[n("DBDataTable",{ref:"table",attrs:{project:t.project,show_only_non_matched:t.show_only_non_matched}})],1)],1)],1)},o=[],c=n("1da1"),i=(n("96cf"),n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),n("ac1f"),n("841c"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"data"},[t.project&&t.project.node.settings?[t._v(" matched: "+t._s(t.stats.total-t.stats.non_matched)+"/"+t._s(t.stats.total)+" "),t.stats.total&&0==t.stats.non_matched?n("div",{staticClass:"alert alert-success"},[t._v("All done!")]):t._e(),t.data.length>0?[n("b-table",{attrs:{striped:"",hover:"",items:t.data,fields:t.fields},scopedSlots:t._u([{key:"cell("+t.suggestions_field+")",fn:function(e){return[n("div",{domProps:{innerHTML:t._s(t.formatReconciliationResult(e.value,e.item))}})]}},{key:"cell("+t.match_field+")",fn:function(e){return[n("div",{domProps:{innerHTML:t._s(t.formatReconciliationMatch(e.value,e.item))}})]}}],null,!0)})]:t._e()]:n("div",[n("div",{staticClass:"alert alert-warning"},[t._v("Did not find reconciliation data! Did you run reconciliation node?")])])],2)}),s=[],u=n("b85c"),l=(n("99af"),n("466d"),n("b0c0"),n("d81d"),n("a15b"),n("7db0"),n("1276"),n("5319"),n("bc3a")),d=n.n(l),f={};f.getProject=Object(c["a"])(regeneratorRuntime.mark((function t(){var e,n,a,r,o,c,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=new URLSearchParams(window.location.search),n=e.get("node"),t.next=4,d.a.get("/api/v2/nodes/".concat(n));case 4:return a=t.sent,r=a.data.project,t.next=8,d.a.get("/api/v2/projects/".concat(r));case 8:return o=t.sent,c=o.data.nodes.find((function(t){return t._id===n})),i=o.data.collections.find((function(t){return t.name===c.collection})),s={title:o.data.title,node:c,collection:i},t.abrupt("return",s);case 13:case"end":return t.stop()}}),t)}))),f.getData=function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(e,n,a){var r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r='{"$or":[{"'.concat(a,'": {"$exists":false}}, {"').concat(a,'":""}]}'),"yes"!==n){t.next=7;break}return t.next=4,d.a.get("/api/v2/collections/".concat(e,"/docs?mongoquery=").concat(r));case 4:o=t.sent,t.next=10;break;case 7:return t.next=9,d.a.get("/api/v2/collections/".concat(e,"/docs"));case 9:o=t.sent;case 10:return t.abrupt("return",o);case 11:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}(),f.getStats=function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(e,n){var a,r,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a='{"$or":[{"'.concat(n,'": {"$exists":false}}, {"').concat(n,'":""}]}'),t.next=3,d.a.get("/api/v2/collections/".concat(e,"/count"));case 3:return r=t.sent,t.next=6,d.a.get("/api/v2/collections/".concat(e,"/count?mongoquery=").concat(a));case 6:return o=t.sent,c={total:r.data.count,non_matched:o.data.count},t.abrupt("return",c);case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),f.setData=function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(e,n,a){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,d.a.put("/api/v2/collections/".concat(e,"/docs/").concat(n),a);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}(),f.getURLQueryParamsAsString=function(){var t=document.URL.split("?");return 2==t.length?t[1].replace(/\?/g,""):""};var p=f,h={name:"DBDataTable",props:["show_only_non_matched","project"],data:function(){return{stats:{total:-1,non_matched:0},data:[],fields:[],suggestions_field:"",match_field:""}},methods:{formatNoMatch:function(t,e){return"<button onclick=\"window.table.setSelection('".concat(e._id,'\', \'none\')" title="Click if there is no good suggestion" class="btn btn-outline-primary">No good match!</button>')},formatReconciliationResult:function(t,e){var n="<table>";if(e[this.match_field])return'<button class="btn btn-outline-primary" onclick="window.table.setSelection(\''.concat(e._id,"', '')\">Change selection </button> (").concat(t.result.length," suggestions)");if(t.result){var a,r=Object(u["a"])(t.result);try{for(r.s();!(a=r.n()).done;){var o=a.value;if(o.match)n+='<tr><td><span class="badge badge-success"> match!</span> <b class="text-info">'.concat(o.name," </b></td>"),n+='<td><a target="_blank" href="https://www.wikidata.org/wiki/'.concat(o.id,'">').concat(o.id,"</a></td><td></td>"),n+="<td><button onclick=\"window.table.setSelection('".concat(e._id,"', '").concat(o.id,'\')" class="btn btn-primary" type="button">select</button></td></tr>');else{var c="".concat(o.score);100==o.score&&(c="<b>".concat(o.score,"</b>")),n+='<tr><td style="width:35%"><b>'.concat(o.name,"</b><br> (").concat(this.getTypes(o.type),")</td>"),n+='<td><a target="_blank" href="https://www.wikidata.org/wiki/'.concat(o.id,'">').concat(o.id,"</a></td>"),n+="<td>".concat(c);var i,s=Object(u["a"])(o.features);try{for(s.s();!(i=s.n()).done;){var l=i.value;n+="<div>".concat(l.id," : ").concat(l.value,"</div>")}}catch(d){s.e(d)}finally{s.f()}n+="</td><td><button onclick=\"window.table.setSelection('".concat(e._id,"', '").concat(o.id,'\')" class="btn btn-primary" type="button">select</button></td><tr>')}}}catch(d){r.e(d)}finally{r.f()}}return n+="<tr><td></td><td></td><td></td><td><button onclick=\"window.table.setSelection('".concat(e._id,'\', \'none\')" title="Click if there is no good suggestion" class="btn btn-outline-primary">No good match!</button></td></tr>'),n+"</table>"},formatReconciliationMatch:function(t,e){return this.pickWID(t,e)},getTypes:function(t){var e=t.map((function(t){return t.name}));return e.join(", ")},pickWID:function(t,e){var n="";if(e[this.suggestions_field]&&e[this.suggestions_field].result){if("none"===t)return'<div class="badge badge-warning">No good match found!</div>';var a,r=Object(u["a"])(e[this.suggestions_field].result);try{for(r.s();!(a=r.n()).done;){var o=a.value;o.id==t&&(n+='<b class="text-info">'.concat(o.name,' (<a href="">').concat(o.id,"</a>)</b>"))}}catch(c){r.e(c)}finally{r.f()}""===n&&(n='<div class="badge badge-danger">Not matched!</div>')}return n},setSelection:function(t,e){var n=this;return Object(c["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={},r[n.match_field]=e,a.next=4,p.setData(n.project.collection.name,t,r);case 4:return a.next=6,n.getData();case 6:case"end":return a.stop()}}),a)})))()},getData:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p.getData(t.project.collection.name,t.show_only_non_matched,t.match_field);case 2:return n=e.sent,t.data=n.data.data,e.next=6,p.getStats(t.project.collection.name,t.match_field);case 6:t.stats=e.sent;case 7:case"end":return e.stop()}}),e)})))()}},watch:{show_only_non_matched:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getData();case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),project:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.project.node){t.next=6;break}return this.suggestions_field=this.project.node.params.out_result,this.match_field=this.project.node.params.out_match,this.fields=this.fields.concat([this.project.node.params.in_field,this.suggestions_field,this.match_field]),t.next=6,this.getData();case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:window.table=this;case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},b=h,m=n("2877"),g=Object(m["a"])(b,i,s,!1,null,null,null),v=g.exports,_=(n("f9e3"),n("2dd8"),{name:"App",components:{DBDataTable:v},data:function(){return{project:null,show_only_non_matched:!1,error:null}},mounted:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=new URLSearchParams(window.location.search),n=e.get("node"),n){t.next=6;break}this.error="Node URL parameter missing! This app must be open from reconciliation node.",t.next=9;break;case 6:return t.next=8,p.getProject();case 8:this.project=t.sent;case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}),w=_,y=Object(m["a"])(w,r,o,!1,null,null,null),j=y.exports,x=n("5f5b"),k=n("b1e0"),R=n("67b0");a["default"].use(x["a"]),a["default"].use(k["a"]),a["default"].use(R["a"]),a["default"].config.productionTip=!1,new a["default"]({render:function(t){return t(j)}}).$mount("#app")}});
//# sourceMappingURL=app.0f831d5f.js.map