(function(e){function t(t){for(var r,a,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);u&&u(t);while(p.length)p.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={app:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"1ad9":function(e,t,n){"use strict";n("2408")},"1bdd":function(e,t,n){},2408:function(e,t,n){},3181:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-row",[n("b-col",{attrs:{cols:"3"}},[n("GPMainSidebar")],1),n("b-col",{attrs:{cols:"9"}},[n("GPProjects")],1)],1)},o=[],i=n("677c"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"hello"},[n("b-card",{attrs:{header:"Create project","header-tag":"h5"}},[n("b-card-text",[e._v("Project contains your data, transforms, downloads etc..")]),n("b-form-input",{attrs:{placeholder:"project title"},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),n("br"),n("b-form-input",{attrs:{placeholder:"description (optional)"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}}),n("br"),n("b-form-input",{attrs:{placeholder:"collection name (optional)"},model:{value:e.collection,callback:function(t){e.collection=t},expression:"collection"}}),n("br"),n("b-button",{attrs:{href:"#",variant:"primary"},on:{click:e.createProject}},[e._v("Create project")])],1)],1)},s=[],c=n("1da1"),l=(n("96cf"),n("a4d3"),n("e01a"),n("99af"),n("bc3a")),u=n.n(l),d={name:"GPMainSidebar",data:function(){return{title:"",description:"",collection:""}},methods:{createProject:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,""==e.collection&&(e.collection="my data"),t.next=4,u.a.post("/api/v2/projects",{title:e.title,description:e.description,collection:e.collection,star:"zzz"});case 4:n=t.sent,e.title="",e.description="",e.collection="",e.$router.push({path:"/projects/".concat(n.data._id,"?collection=").concat(n.data.collection.id)}),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](0),alert(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})))()}}},p=d,f=n("2877"),_=Object(f["a"])(p,a,s,!1,null,null,null),v=_.exports,h={name:"GPMain",components:{GPProjects:i["a"],GPMainSidebar:v},props:{msg:String}},b=h,g=Object(f["a"])(b,r,o,!1,null,null,null);t["a"]=g.exports},"3dfd":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("b-navbar",{staticClass:"main-header",attrs:{type:"dark"}},[n("b-link",{attrs:{to:{path:"/"}}},[n("b-navbar-brand",[e._v("Â GLAMpipe "),n("span",{staticStyle:{"font-size":"0.8rem"}},[e._v(e._s(e.config.version)+" ")])])],1),e.$G.current_project?n("b-navbar-brand",{staticStyle:{"font-size":"1.0rem","margin-left":"25%"}},[n("span",[e.showTitleEdit?[n("b-input",{model:{value:e.$G.current_project.title,callback:function(t){e.$set(e.$G.current_project,"title",t)},expression:"$G.current_project.title"}}),n("b-button",{on:{click:function(t){e.showTitleEdit=!1}}},[e._v("cancel")]),n("b-button",{on:{click:e.saveTitle}},[e._v("save")])]:[n("b",[e._v(" "+e._s(e.$G.current_project.title))])]],2)]):e._e(),e.$G.current_project?n("b-navbar-brand",{staticStyle:{"font-size":"1.0rem","margin-left":"10px"}},[n("span",[n("i",[e._v(e._s(e.$G.current_project.description))])])]):e._e(),e.$store.state.running_node?n("b-navbar-brand",[e._v(" running "+e._s(e.$store.state.running_node.title)+" ")]):e._e(),n("b-navbar-brand",{staticClass:"float-right"},[e._v(" "+e._s(e.$store.state.user.user)+" ")])],1),n("b-container",{staticStyle:{padding:"0px",margin:"0px"},attrs:{fluid:""}},[e.error?e._e():n("router-view",{staticClass:"view"}),e.error?n("div",{staticClass:"alert alert-danger"},[e._v(e._s(e.error))]):e._e()],1)],1)},o=[],i=n("1da1"),a=(n("96cf"),n("bc3a")),s=n.n(a),c={name:"app",data:function(){return{error:null,user:null,config:{version:""},showTitleEdit:!1,showDescriptionEdit:!1,logging:!1}},created:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("App created"),e.prev=1,e.next=4,s.a.get("/api/v2/user");case 4:return t=e.sent,this.$G.user=t.data,e.next=8,s.a.get("/api/v2/config");case 8:n=e.sent,this.config=n.data,e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](1),console.log("GLAMpipe is not responding"),this.error="GLAMpipe is not responding";case 16:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},l=c,u=(n("034f"),n("2877")),d=Object(u["a"])(l,r,o,!1,null,null,null);t["a"]=d.exports},"45be":function(e,t,n){"use strict";n("9786")},"56d7":function(e,t,n){"use strict";n.r(t),function(e){var t=n("1da1"),r=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("96cf"),n("7db0"),n("4de4"),n("fb6a"),n("a15b"),n("ac1f"),n("1276"),n("2b0e")),o=n("2f62"),i=n("8c4f"),a=n("5f5b"),s=n("b1e0"),c=n("5132"),l=n.n(c),u=n("67b0"),d=n("bc3a"),p=n.n(d),f=n("3dfd"),_=n("3181"),v=n("677c"),h=n("73bf");n("f9e3"),n("2dd8");r["default"].use(a["a"]),r["default"].use(s["a"]),r["default"].use(i["a"]),r["default"].use(u["a"]),r["default"].use(o["a"]);var b=new o["a"].Store({state:{connect:!1,current_project:null,running_projects:null,current_collection:null,running_node:null,output_fields:null,input_fields:null,visible:[],user:{},socket_finish:{},socket_progress:{},socket_error:{}},getters:{getVisibleFields:function(e){return function(t){return e.user&&e.user.fields?e.user.fields.find((function(e){return e.collection===t})):[]}}},mutations:{socket_finish:function(e,t){this.state.socket_finish=t},socket_progress:function(e,t){this.state.socket_progress=t},socket_error:function(e,t){this.state.socket_error=t},current_project:function(e,t){this.state.current_project=t},current_collection:function(e,t){this.state.current_collection=t},current_node:function(e,t){this.state.current_node=t},running_node:function(e,t){this.state.running_node=t},add_running_project:function(e,t){this.state.running_projects.push(t)},remove_running_project:function(e,t){this.state.running_projects=this.state.running_projects.filter((function(e){return e!==t}))},user:function(e,t){this.state.user=t},visible:function(e,t){this.state.visible=t}},actions:{SOCKET_connect:function(){console.log("CONNNNNNECTING")},SOCKET_progress:function(e,t){console.log("progress data.."),console.log(e),console.log("progress msg"),console.log(t.msg),this.commit("socket_progress",t)},SOCKET_finish:function(e,t){console.log("finish data"),console.log(e),console.log("finish msg"),console.log(t.msg),this.commit("running_node",null),this.commit("socket_finish",t)},SOCKET_error:function(e,t){console.log("error data.."),console.log(e),console.log("error msg"),console.log(t.msg),this.commit("socket_error",t)},visible:function(e,t){console.log("set visible field"),console.log(t),this.commit("visible",t),p.a.put("/api/v2/user/fields",{collection:this.state.current_collection,fields:this.state.visible})}}});r["default"].use(new l.a({debug:!0,connection:"",vuex:{store:b,actionPrefix:"SOCKET_",mutationPrefix:"SOCKET_"},options:{path:"/socket.io/"}})),r["default"].config.productionTip=!1;var g=new i["a"]({base:e,routes:[{path:"/",component:_["a"]},{path:"/projects",component:v["a"]},{path:"/projects/:id",component:h["a"]},{path:"/projects/:id/collection/:collection",component:h["a"]}]}),m=new r["default"]({data:{api_url:"/s/converis",login:!0,error:null,user:{},current_project:null,current_collection:null,current_node:null,current_node_fields:[],visible_fields:[],running_single:!1,showSideBar:!0,showNodeSettings:!1,editorContent:""},methods:{getUserFields:function(e){var n=this;return Object(t["a"])(regeneratorRuntime.mark((function t(){var r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p.a.get("/api/v2/user");case 2:if(r=t.sent,n.user.fields=r.data.fields,!n.user||!n.user.fields){t.next=13;break}if(o=n.user.fields.find((function(t){return t.collection===e})),!o){t.next=10;break}return t.abrupt("return",o.fields);case 10:return t.abrupt("return",[]);case 11:t.next=14;break;case 13:return t.abrupt("return",[]);case 14:case"end":return t.stop()}}),t)})))()},updateUserFields:function(e){this.visible_fields=e,p.a.put("/api/v2/user/fields",{collection:this.current_collection,fields:e})},getToday:function(){var e=new Date;return e.getFullYear()+"."+("0"+(e.getMonth()+1)).slice(-2)+"."+("0"+e.getDate()).slice(-2)},renderBreaks:function(e,t){return e&&"string"===typeof e?e.split(t).join("<br>"):""}},computed:{c_node:function(){return this.current_node},local:function(){return"localhost"==window.location.hostname?"":this.api_url}}});m.install=function(){Object.defineProperty(r["default"].prototype,"$G",{get:function(){return m}})},r["default"].use(m),new r["default"]({router:g,store:b,render:function(e){return e(f["a"])}}).$mount("#app")}.call(this,"/")},6137:function(e,t,n){"use strict";n("840f")},6356:function(e,t,n){"use strict";n("e177")},"677c":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"hello"},[n("b-card",{attrs:{header:"Projects","header-tag":"h5"}},[n("b-card-body",[n("b-table",{attrs:{small:"",striped:"",hover:"",items:e.projects,fields:e.fields},scopedSlots:e._u([{key:"cell(title)",fn:function(t){return[n("b-link",{attrs:{to:{path:e.projectURL(t.item)}}},[e._v(" "+e._s(t.item.title))]),n("span",{staticClass:"dim"},[e._v(" ("+e._s(t.item.collection_count)+" collections,")]),n("span",{staticClass:"dim"},[e._v(" "+e._s(t.item.node_count)+" nodes)")]),n("div",{staticClass:"font-italic"},[e._v(e._s(t.item.description))])]}},{key:"cell(remove)",fn:function(t){return[n("b-icon-trash",{staticClass:"pointer",attrs:{variant:"danger"},on:{click:function(n){return e.openDeleteDialog(t.item)}}},[e._v("poista")])]}},{key:"cell(star)",fn:function(t){return["yes"!=t.item.star?n("b-icon-star",{staticClass:"pointer",attrs:{variant:"success"},on:{click:function(n){return e.starProject(t.item._id)}}}):n("b-icon-star-fill",{staticClass:"pointer",attrs:{variant:"success"},on:{click:function(n){return e.unStarProject(t.item._id)}}})]}}])})],1)],1),e.selected_for_delete?n("b-modal",{attrs:{okTitle:"Delete","ok-variant":"danger","header-bg-variant":"info",title:"Confirm delete"},on:{ok:e.deleteProject},model:{value:e.showDelete,callback:function(t){e.showDelete=t},expression:"showDelete"}},[n("div",[n("div",{staticClass:"alert alert-danger"},[n("p",[n("b-icon-trash",{attrs:{variant:"danger"}}),e._v(" Delete "),n("b",[e._v(e._s(e.selected_for_delete.title))]),e._v("?")],1),n("p",[e._v("Removes ALL data and nodes")])])])]):e._e()],1)},o=[],i=n("1da1"),a=(n("96cf"),n("99af"),n("b0c0"),n("bc3a")),s=n.n(a),c={name:"GPProjects",data:function(){return{projects:null,selected_for_delete:null,showDelete:!1,fields:[{key:"star",label:"starred"},{key:"title",label:"title"},{key:"created",label:"created"},{key:"remove",label:"delete"}]}},methods:{projectURL:function(e){return e.collections&&e.collections.length?"/projects/".concat(e._id,"?collection=").concat(e.collections[0].name):"/projects/".concat(e._id)},loadData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s()("/api/v2/projects?sort=star,created&limit=100");case 2:n=t.sent,e.projects=n.data.data;case 4:case"end":return t.stop()}}),t)})))()},starProject:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,s.a.put("/api/v2/projects/".concat(e),{star:"yes"});case 2:t.loadData();case 3:case"end":return n.stop()}}),n)})))()},unStarProject:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,s.a.put("/api/v2/projects/".concat(e),{star:"zzz"});case 2:t.loadData();case 3:case"end":return n.stop()}}),n)})))()},deleteProject:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.a.delete("/api/v2/projects/".concat(e.selected_for_delete._id));case 2:e.selected_for_delete=null,e.loadData();case 4:case"end":return t.stop()}}),t)})))()},openDeleteDialog:function(e){this.selected_for_delete=e,this.showDelete=!this.showDelete}},updated:function(){this.$G.current_project=null,this.$G.current_collection=null,this.$G.current_node=null,this.$G.visible_fields=[]},created:function(){this.$store.commit("current_collection",null),this.$store.commit("current_project",null),this.$G.current_project=null,this.$G.current_collection=null,this.$G.visible_fields=[],this.loadData()}},l=c,u=(n("6356"),n("2877")),d=Object(u["a"])(l,r,o,!1,null,null,null);t["a"]=d.exports},"6d77":function(e,t,n){"use strict";n("ef9c")},"714a":function(e,t,n){"use strict";n("cbea")},"73bf":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-row",[n("b-button",{directives:[{name:"show",rawName:"v-show",value:!e.$G.showSideBar,expression:"!$G.showSideBar"}],on:{click:function(t){e.$G.showSideBar=!e.$G.showSideBar}}},[n("b-icon",{attrs:{icon:"caret-right"}})],1),n("b-col",{directives:[{name:"show",rawName:"v-show",value:e.$G.showSideBar,expression:"$G.showSideBar"}],staticClass:"sideBar",attrs:{cols:"3"}},[n("b-container",{staticStyle:{"padding-left":"0px","background-color":"#EFEFEF"},attrs:{fluid:""}},[n("GPprojectSidebar")],1)],1),n("b-col",{attrs:{cols:"9"}},[n("GPnodeRun"),n("GPdataTable")],1)],1)},o=[],i=n("1da1"),a=(n("ac1f"),n("1276"),n("5319"),n("caad"),n("2532"),n("99af"),n("96cf"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-card",{directives:[{name:"show",rawName:"v-show",value:e.showSideBar,expression:"showSideBar"}],staticClass:"project-sidebar",attrs:{"header-tag":"header"},scopedSlots:e._u([{key:"header",fn:function(){return[e.$G.current_project&&e.$G.current_collection?n("div",{attrs:{id:"collection-nav"}},[n("b-navbar",{attrs:{toggleable:"m"}},[n("span",{on:{click:function(t){e.$G.showSideBar=!e.$G.showSideBar}}},[n("b-icon",{attrs:{icon:"caret-left"}})],1),n("b-navbar-brand",[n("span",[e._v("Nodes for ")]),n("b-navbar-toggle",{attrs:{target:"nav-collapse"}},[e._v(e._s(e.$G.current_collection.title)+" "),n("b-icon",{attrs:{icon:"caret-down"}})],1),n("b-collapse",{attrs:{id:"nav-collapse","is-nav":""},model:{value:e.showCollectionChooser,callback:function(t){e.showCollectionChooser=t},expression:"showCollectionChooser"}},[n("b-navbar-nav",{staticClass:"ml-auto"},e._l(e.$G.current_project.collections,(function(t){return n("b-nav-item",{key:t.name,on:{click:function(n){return e.setCurrentCollection(t)}}},[n("li",[e._v(e._s(t.title))])])})),1),n("b-link",{on:{click:function(t){e.showAddCollection=!e.showAddCollection}}},[n("b-icon",{attrs:{variant:"info",icon:"plus-circle-fill"}})],1)],1)],1)],1)],1):e._e()]},proxy:!0}])},[n("b-card-body",[e.$G.current_project?n("div",{attrs:{id:"node-nav"}},e._l(e.nodetypes,(function(t){return n("div",{key:t.key},[n("div",{staticStyle:{"margin-top":"25px"}},[n("h5",{attrs:{small:""}},[e._v(e._s(t.label)+" "),n("b-navbar-toggle",{attrs:{target:""+t.key}},[n("b-link",[n("b-icon",{attrs:{icon:"plus-circle"}})],1)],1)],1),n("b-collapse",{ref:""+t.key,refInFor:!0,staticStyle:{"margin-bottom":"2em"},attrs:{id:""+t.key,"is-nav":""}},[n("b-list-group",e._l(e.verbose[t.key],(function(r,o){return n("b-list-group-item",{key:r},[n("b-navbar-toggle",{attrs:{target:t.key+"-"+o}},[e._v(e._s(r))]),n("b-collapse",{staticClass:"sub",staticStyle:{"margin-bottom":"2em"},attrs:{id:t.key+"-"+o,"is-nav":""}},[n("div",[e._l(e.repository,(function(r){return[r.type==t.key&&r.subtype==o?n("b-card",{key:r._id},[n("b-link",{on:{click:function(t){e.current_repo_node=r,e.showAddNode=!0}}},[e._v(e._s(r.title))]),n("p",{staticClass:"small"},[e._v(e._s(r.description))])],1):e._e()]}))],2)])],1)})),1)],1)],1),e.nodes_sorted?e._l(e.nodes_sorted[t.key],(function(r){return n("div",{key:t.key+"-"+r._id,staticClass:"box node",class:e.$G.current_node&&e.$G.current_node._id==r._id?"active_node pointer":"else_class pointer",attrs:{header:"Info"}},[n("div",{staticClass:"boxleft"},[n("div",{on:{click:function(t){return e.setCurrentNode(r)}}},[r.node_description?n("div",{staticClass:"title boxtitle"},[e._v(e._s(r.node_description))]):n("div",{staticClass:"title boxtitle"},[e._v(e._s(r.title))]),n("div",[n("GPNode",{attrs:{node:r}})],1),r.params.file?n("div",[n("b-badge",[e._v(e._s(r.params.file))])],1):e._e()]),e.$G.current_node&&e.$G.current_node._id==r._id?n("div",[n("div",{on:{click:function(t){return e.setCurrentNode(r)}}},[r.node_description?n("div",{staticClass:"description"},[e._v(e._s(r.title)+" ")]):n("div",{staticClass:"description"},[e._v(e._s(r.description)+" ")])]),n("b-link",{on:{click:function(t){e.showDeleteNode=!0}}},[n("b-icon",{staticClass:"float-right",attrs:{variant:"danger",title:"Delete node",icon:"x-circle"}})],1)],1):e._e()])])})):e._e()],2)})),0):e._e(),n("b-modal",{attrs:{title:"Add collection","header-bg-variant":"info",okTitle:"Create"},on:{ok:e.createCollection},model:{value:e.showAddCollection,callback:function(t){e.showAddCollection=t},expression:"showAddCollection"}},[n("div",[n("b-input",{attrs:{placeholder:"collection title"},model:{value:e.new_collection,callback:function(t){e.new_collection=t},expression:"new_collection"}})],1)]),n("b-modal",{attrs:{title:"Delete node","header-bg-variant":"info",okTitle:"Delete"},on:{ok:e.deleteNode},model:{value:e.showDeleteNode,callback:function(t){e.showDeleteNode=t},expression:"showDeleteNode"}},[n("div",[e._v(" This will delete node and ALL data it produced! ")])]),e.current_repo_node?n("b-modal",{attrs:{title:e.current_repo_node.title,"header-bg-variant":"info",okTitle:"Create node"},on:{shown:e.initNodeParams,ok:e.createNode},model:{value:e.showAddNode,callback:function(t){e.showAddNode=t},expression:"showAddNode"}},[n("div",[n("p",[e._v(e._s(e.current_repo_node.description))]),n("h5",[e._v("Node parameters")]),n("b-card",{attrs:{id:"node-parameters"}},[n("b-card-body",{domProps:{innerHTML:e._s(e.current_repo_node.views.params)}})],1)],1)]):e._e()],1)],1)}),s=[],c=n("b85c"),l=(n("7db0"),n("d3b7"),n("ddb0"),n("b0c0"),n("d81d"),n("4de4"),n("a15b"),n("2ca0"),n("bc3a")),u=n.n(l),d=n("1157"),p=n.n(d),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",["old input"==e.node.error?n("div",{staticClass:"alert ",attrs:{title:"The data of this node is outdated because node's input field(s) has been re-created. "}},[n("b-icon",{attrs:{icon:"exclamation-triangle-fill",variant:"danger"}}),e._v(" Old input, re-run me!")],1):e.node.error?n("div",{staticClass:"alert "},[n("b-icon",{attrs:{icon:"exclamation-triangle-fill",variant:"danger"}}),e._v(" "+e._s(e.node.error))],1):e._e(),e.node.settings?[e._l(e.node.input,(function(t){return n("b-badge",{key:t},[n("b-icon",{attrs:{icon:"arrow-right-square"}}),e._v(" "+e._s(t)+" ")],1)})),e._l(e.node.output,(function(t){return n("b-badge",{key:t,attrs:{variant:"success"}},[e._v(" "+e._s(t)+" "),n("b-icon",{attrs:{icon:"arrow-right-square"}})],1)}))]:[n("div",{staticClass:"alert alert-warning"},[n("b-icon",{attrs:{icon:"exclamation-triangle-fill",variant:"danger"}}),e._v(" Run me from settings!")],1)]],2)},_=[],v={name:"GPNode",props:{node:Object}},h=v,b=(n("1ad9"),n("2877")),g=Object(b["a"])(h,f,_,!1,null,null,null),m=g.exports,y={name:"GPProjectSidebar",components:{GPNode:m},data:function(){return{showSideBar:!0,showAddNode:!1,showDeleteNode:!1,showAddCollection:!1,showCollectionChooser:!1,new_collection:"",initAddNode:!1,nodes:null,current_node:null,current_subtype:null,current_repo_node:null,params_html:"",nodes_sorted:null,repository:[],schema:null,nodetypes:[{key:"source",label:"Read data"},{key:"process",label:"Process the data"},{key:"export",label:"Write the data"},{key:"view",label:"View the data"}],subtypes:{},verbose:{source:{file:"Read data from file",web:"Read data from web",collection:"Read data from collection",directory:"Read data from directory"},process:{strings:"Field operations",format:"Format/Map data",collection:"Manage collection",files:"File operations",lookups:"Look up data"},export:{file:"Export data to file",web:"Export data to web"},view:{data:"View data"}}}},watch:{$route:function(){this.$route.query.collection?this.getCurrentCollectionFromURL():this.current_collection=null},"$store.state.running_node":function(){console.log("NODE RUN notified"),this.loadNodes()}},methods:{loadProject:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u()("/api/v2/projects/".concat(e.$route.params.id));case 2:n=t.sent,e.$G.current_project=n.data,e.$route.query.collection&&e.getCurrentCollectionFromURL();case 5:case"end":return t.stop()}}),t)})))()},deleteNode:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u.a.delete("/api/v2/nodes/".concat(e.$G.current_node._id));case 3:e.$G.current_node=null,e.loadNodes(),e.$router.replace({path:"/projects/"+e.$G.current_project._id+"?collection="+e.$route.query.collection+"&update="+e.getRandomInt(10,1e5)}),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},loadNodes:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,o,i,a,s,l,d;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,u()("/api/v2/collections/".concat(t.$route.query.collection,"/nodes?limit=100"));case 2:r=n.sent,console.log("nodet haettu..."),t.nodes=r.data.nodes,t.sortNodes(),e?(t.$G.current_node=t.nodes.find((function(t){return t._id===e})),t.$G.showNodeSettings=!0):t.$G.current_node?(t.$G.showNodeSettings=!0,o=t.nodes.find((function(e){return e._id===t.$G.current_node._id})),o&&(t.$G.current_node.settings=o.settings,t.$G.current_node.error=o.error),o||(t.$G.current_node=null)):t.$G.current_node=null,i=[],a=[],s=Object(c["a"])(t.nodes);try{for(s.s();!(l=s.n()).done;)d=l.value,i=i.concat(d.output),a=a.concat(d.input)}catch(p){s.e(p)}finally{s.f()}t.$G.output_fields=i,t.$G.input_fields=a;case 13:case"end":return n.stop()}}),n)})))()},sortNodes:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r,o,i,a,s,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u()("/api/v2/collections/".concat(e.$route.query.collection,"/schema"));case 2:n=t.sent,e.schema=n.data,e.nodes_sorted={},r=Object(c["a"])(e.nodes);try{for(r.s();!(o=r.n()).done;){i=o.value,e.nodes_sorted[i.type]?e.nodes_sorted[i.type].push(i):e.nodes_sorted[i.type]=[i],a=Object(c["a"])(i.input);try{for(a.s();!(s=a.n()).done;)l=s.value,e.schema.keys.includes(l)||(i.error="input '".concat(l,"' missing "))}catch(d){a.e(d)}finally{a.f()}}}catch(d){r.e(d)}finally{r.f()}case 7:case"end":return t.stop()}}),t)})))()},initNodeParams:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=function(t){return t.name!==e.$G.current_collection.name?e.$G.current_collection.name:null},r=function(e){return'<option value="'.concat(e.name,'"> ').concat(e.title," </option>")},o=e.$G.current_project.collections.filter(n).map(r),p()("#node-parameters select.dynamic-collection").append(o.join("\n")),u.a.get("/api/v2/collections/".concat(e.$route.query.collection,"/schema")).then((function(e){var t=e.data.keys.map((function(e){return"<option>"+e+"</option>"}));p()("#node-parameters select.dynamic-field").append(t.join("\n"))})),e.current_repo_node&&e.current_repo_node.scripts.ui_params?(i=new Function("node","$","g_apipath",e.current_repo_node.scripts.ui_params),i(e.current_repo_node,p.a,"api/v2")):p()("#node-parameters").append("<br>DEBUG: no params script");case 6:case"end":return t.stop()}}),t)})))()},createNode:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r,o,i,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n={},r=[],p()("#node-parameters").find("input.node-params, textarea.node-params, select.node-params").each((function(){"checkbox"==p()(this).attr("type")?p()(this).is(":checked")&&(n[p()(this).attr("name")]="on"):(p()(this).attr("name").startsWith("out_")&&r.push(p()(this).val()),n[p()(this).attr("name")]=p()(this).val())})),o={nodeid:e.current_repo_node.nodeid,project:e.$G.current_project._id,collection:e.$G.current_collection.name,params:n},t.prev=4,i=null,"source"!==e.current_repo_node.type||"file"!==e.current_repo_node.subtype){t.next=20;break}if(a=document.getElementById("file").files[0],a&&a instanceof File){t.next=10;break}throw"You must upload file!";case 10:return o.params.file=a.name,t.next=13,u.a.post("/api/v2/nodes",o);case 13:return i=t.sent,s=new FormData,s.append("file",a),t.next=18,u.a.post("/api/v2/nodes/".concat(i.data.source._id,"/upload"),s,{headers:{"Content-Type":"multipart/form-data"}});case 18:t.next=23;break;case 20:return t.next=22,u.a.post("/api/v2/nodes",o);case 22:i=t.sent;case 23:e.$root.$emit("bv::toggle::collapse",e.current_repo_node.type),e.loadNodes(i.data.uuid),t.next=31;break;case 27:t.prev=27,t.t0=t["catch"](4),t.t0.response&&t.t0.response.data&&t.t0.response.data.error?alert("Node creation failed: "+t.t0.response.data.error):alert("Node creation failed: "+t.t0),e.showAddNode=!0;case 31:case"end":return t.stop()}}),t,null,[[4,27]])})))()},createCollection:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={project:e.$G.current_project._id,title:e.new_collection},e.showCollectionChooser=!1,t.next=4,u.a.post("/api/v2/collections",n);case 4:return r=t.sent,t.prev=5,t.next=8,u()("/api/v2/projects/".concat(e.$route.params.id));case 8:o=t.sent,t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](5),alert("Collection creation failed! "+t.t0);case 14:e.$G.current_project=o.data,e.$router.replace({path:"/projects/"+e.$G.current_project._id+"?collection="+r.data.id}).catch((function(e){console.log(e)}));case 16:case"end":return t.stop()}}),t,null,[[5,11]])})))()},setCurrentCollection:function(e){e&&this.$router.replace({path:"/projects/"+this.$G.current_project._id+"?collection="+e.name})},getCurrentCollectionFromURL:function(){var e=this,t=null;console.log(this.$route.query.collection),this.$route.query.collection&&(t=this.$G.current_project.collections.find((function(t){return t.name==e.$route.query.collection}))),this.$G.current_collection=t,this.loadNodes()},setCurrentNode:function(e){console.log("setting current node to "+e.nodeid),this.$G.showNodeSettings=!1,this.$G.current_node&&this.$G.current_node&&this.$G.current_node._id===e._id?this.$G.current_node=null:this.$G.current_node=e},parseSettingsHTML:function(){this.$store.current_node.views.settings="<input id='testi'/>"},getNodesFromRepository:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u()("/api/v2/repository/nodes?limit=100");case 2:n=t.sent,e.repository=n.data.data;case 4:case"end":return t.stop()}}),t)})))()},getRandomInt:function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)}},created:function(){this.loadProject(),this.getNodesFromRepository()}},$=y,k=(n("6137"),Object(b["a"])($,a,s,!1,null,"0112b17e",null)),w=k.exports,G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.$G.current_node?n("b-card",{scopedSlots:e._u([{key:"header",fn:function(){return[n("h6",{staticClass:"mb-0 pointer",on:{click:function(t){e.$G.showNodeSettings=!e.$G.showNodeSettings}}},[n("b-link",[e.$G.showNodeSettings?e._e():n("b-icon",{attrs:{icon:"caret-down"}}),e.$G.showNodeSettings?n("b-icon",{attrs:{icon:"caret-up"}}):e._e()],1),e._v(" Settings for Node "),n("b",[e._v(e._s(e.$G.current_node.title))])],1)]},proxy:!0}],null,!1,2497960553)},[e.$G.showNodeSettings?n("b-card-body",{attrs:{"text-variant":"info"}},[n("b-tabs",{staticClass:"card-header",attrs:{"content-class":"mt-3 tabbi"},on:{"activate-tab":e.initTab}},[n("b-tab",{attrs:{title:"Settings",active:""}},[n("GPnodeSettings"),n("br"),e.$G.current_node.error?n("div",{staticClass:"alert "},[n("b-icon",{attrs:{icon:"exclamation-triangle-fill",variant:"danger"}}),e._v(" "+e._s(e.$G.current_node.error))],1):e._e(),e.$store.state.running_node?e._e():[e.$G.running_node||"source"!=e.$G.current_node.type?e._e():n("b-button",{attrs:{variant:"primary"},on:{click:function(t){return e.$parent.runNode()}}},[n("b-icon",{attrs:{icon:"play"}}),e._v(" Import data")],1),e.$G.running_node||"process"!=e.$G.current_node.type?e._e():n("b-button",{attrs:{variant:"primary"},on:{click:function(t){return e.$parent.runNode()}}},[n("b-icon",{attrs:{icon:"play"}}),e._v(" Run for all documents")],1),e.$G.running_node||"export"!=e.$G.current_node.type?e._e():n("b-button",{attrs:{variant:"primary"},on:{click:function(t){return e.$parent.runNode()}}},[n("b-icon",{attrs:{icon:"play"}}),e._v(" Export all documents")],1),e.$G.running_node||"view"!=e.$G.current_node.type?e._e():n("b-button",{attrs:{variant:"primary"},on:{click:function(t){return e.$parent.runNode()}}},[n("b-icon",{attrs:{icon:"play"}}),e._v(" Generate view")],1)],e.$store.state.running_node&&e.$store.state.running_node._id==e.$G.current_node._id?n("b-button",{attrs:{variant:"primary"},on:{click:function(t){return e.stopNode()}}},[e._v("stop")]):e._e(),n("br"),n("br"),e.$store.state.socket_error&&e.$store.state.socket_error.node_uuid==e.$G.current_node._id?n("div",{staticClass:"alert alert-warning"},[e._v(e._s(e.$store.state.socket_error.msg))]):e._e(),!e.$store.state.socket_error&&e.$store.state.socket_finish&&e.$store.state.socket_finish.node_uuid==e.$G.current_node._id?n("div",{staticClass:"alert alert-info"},[e._v(e._s(e.$store.state.socket_finish.msg))]):e._e(),!e.$store.state.socket_error&&e.$store.state.socket_progress&&e.$store.state.socket_progress.node_uuid==e.$G.current_node._id?n("div",{staticClass:"alert alert-info"},[e._v(e._s(e.$store.state.socket_progress.msg))]):e._e()],2),e.$G.current_node.views.help?n("b-tab",{attrs:{title:"Help"}},[n("div",{domProps:{innerHTML:e._s(e.$G.current_node.views.help)}})]):e._e(),n("b-tab",{attrs:{title:"Description"}},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.$G.current_node.description,expression:"$G.current_node.description"}],attrs:{cols:"100"},domProps:{value:e.$G.current_node.description},on:{input:function(t){t.target.composing||e.$set(e.$G.current_node,"description",t.target.value)}}}),n("br"),n("b-button",{on:{click:function(t){return e.saveNodeDescription()}}},[e._v("Save")])],1),e.$G.current_node.scripts.options?n("b-tab",{attrs:{title:"Options JS"}},[n("div",[e._v("Options script is called once for every document before process.js. It should set core.options.")]),n("editor",{attrs:{id:"code-editor",lang:"javascript",theme:"twilight",width:"100%",height:"400"},on:{init:e.editorInit},model:{value:e.$G.current_node.scripts.options,callback:function(t){e.$set(e.$G.current_node.scripts,"options",t)},expression:"$G.current_node.scripts.options"}}),n("br"),n("b-button",{attrs:{variant:"primary",title:"Save your own version of script"},on:{click:function(t){return e.saveScript("options")}}},[e._v("Save")]),n("b-button",{staticClass:"float-right",attrs:{title:"Revert script to its original form"},on:{click:function(t){return e.revertScript("options")}}},[e._v("Revert")])],1):e._e(),n("b-tab",{attrs:{title:"Processing JS"}},[n("div",[e._v("Processing script is called once for every document.")]),n("editor",{attrs:{id:"code-editor",lang:"javascript",theme:"twilight",width:"100%",height:"400"},on:{init:e.editorInit},model:{value:e.$G.current_node.scripts.process,callback:function(t){e.$set(e.$G.current_node.scripts,"process",t)},expression:"$G.current_node.scripts.process"}}),n("br"),n("b-button",{attrs:{variant:"primary",title:"Save your own version of script"},on:{click:function(t){return e.saveScript("process")}}},[e._v("Save")]),n("b-button",{staticClass:"float-right",attrs:{title:"Revert script to its original form"},on:{click:function(t){return e.revertScript("process")}}},[e._v("Revert")])],1),n("b-tab",{attrs:{title:"debug"}},[n("h5",[e._v("params")]),n("table",{staticClass:"table b-table"},e._l(e.$G.current_node.params,(function(t,r){return n("tr",{key:"set"+t},[n("td",[n("b",[e._v(e._s(r))])]),n("td",[e._v(e._s(t))])])})),0),n("h5",[e._v("settings")]),n("table",{staticClass:"table b-table"},e._l(e.$G.current_node.settings,(function(t,r){return n("tr",{key:"set"+t},["last_run"==r?[n("td",[n("b",[e._v(e._s(r))])]),n("td",[e._v(e._s(e.getLastRun(t)))])]:[n("td",[n("b",[e._v(e._s(r))])]),n("td",[e._v(e._s(t))])]],2)})),0),n("a",{attrs:{target:"_blank",href:"http://localhost:3000/api/v2/nodes/"+e.$G.current_node._id}},[e._v("API")]),n("br"),n("br"),n("b-button",{on:{click:function(t){return e.$store.commit("running_node",e.$G.current_node)}}},[e._v("debug run")]),n("b-button",{on:{click:function(t){return e.$store.commit("running_node",null)}}},[e._v("debug stop")])],1)],1),e.info?n("div",{staticClass:"alert alert-info"},[e._v(e._s(e.info))]):e._e()],1):e._e()],1):e._e()],1)},x=[],j=(n("a4d3"),n("e01a"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"nodesettings",attrs:{id:"node-settings"}},[n("b-collapse",{attrs:{visible:"",appear:"",id:"set"},on:{shown:e.initSettings}},[n("div",{domProps:{innerHTML:e._s(e.$G.current_node.views.settings)}}),"process_script"==e.$G.current_node.nodeid?n("setting",[n("settinginfo",[n("settingtitle",[e._v("script editor ")])],1),n("editor",{attrs:{id:"code-editor",lang:"javascript",theme:"twilight",width:"100%",height:"300"},on:{init:e.editorInit},model:{value:e.$G.editorContent,callback:function(t){e.$set(e.$G,"editorContent",t)},expression:"$G.editorContent"}})],1):e._e()],1)],1)}),C=[],S={name:"GPnodeSettings",components:{editor:n("7c9e")},data:function(){return{showNodeSettings:!0,scriptInitted:!1,running:!1}},watch:{"$G.current_node":function(){this.$G.showNodeSettings=!1,this.$G.current_node&&console.log("current node")}},methods:{initSettings:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r,o,i,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.scriptInitted){t.next=20;break}return t.next=3,u.a.get("/api/v2/collections/".concat(e.$route.query.collection,"/schema"));case 3:if(n=t.sent,r=n.data.keys.map((function(e){return"<option>"+e+"</option>"})),o=n.data.keys.map((function(e){return"<input class='node-settings-fields' type='checkbox' checked='checked' name='fields_".concat(e,"'/>").concat(e,"<br>")})),p()("#node-settings select.dynamic-field").append(r.join("\n")),p()("#node-settings .dynamic-field-checkboxes").append(o.join("\n")),!e.$G.current_node.params||!e.$G.current_node.params.required_source_collection){t.next=15;break}return t.next=11,u.a.get("/api/v2/collections/".concat(e.$G.current_node.params.required_source_collection,"/schema"));case 11:i=t.sent,a=i.data.keys.map((function(e){return"<option>"+e+"</option>"})),p()("#node-settings select.lookup-dynamic-field").append(a.join("\n")),p()("#node-settings select.lookup-dynamic-field").append(a.join("\n"));case 15:e.$G.current_node.settings||(e.$G.current_node.settings={}),s=new Function("node","$","g_apipath",e.$G.current_node.scripts.ui_settings),s(e.$G.current_node,p.a,"api/v2"),e.insertSettings(),e.$G.current_node.nodeid.includes("script")&&(e.$G.current_node.settings.js?e.$G.editorContent=e.$G.current_node.settings.js:e.$G.editorContent="out.value = 'Hello World, id of this document is: ' + context.doc._id ");case 20:case"end":return t.stop()}}),t)})))()},insertSettings:function(){var e={};for(var t in e.settings=this.$G.current_node.settings,this.$G.current_node.settings)if("true"==e.settings[t]||"false"==e.settings[t]||"boolean"===typeof e.settings[t]){var n=e.settings[t];"boolean"!==typeof e.settings[t]&&(n="true"==e.settings[t]),p()("input[name='"+t+"']").prop("checked",n),p()("input[name='"+t+"']").change()}else if(Array.isArray(e.settings[t]))for(var r=0;r<e.settings[t].length;r++){var o=r+1;p()("input[name='"+t+"["+o+"]']").val(e.settings[t][r])}else console.log("input[name='"+t+"']"),p()("input[name='"+t+"']").val(e.settings[t]),p()("select[name='"+t+"']").val(e.settings[t]),p()("select[name='"+t+"']").change(),p()("textarea[name='"+t+"']").val(e.settings[t])},editorInit:function(e){e.setFontSize(16),n("2099"),n("be9d"),n("bb36"),n("0329"),n("79fb"),n("6a21")}}},R=S,N=(n("ece9"),Object(b["a"])(R,j,C,!1,null,"08b85838",null)),O=N.exports,q={name:"GPnodeRun",components:{GPnodeSettings:O,editor:n("7c9e")},data:function(){return{showNodeSettings:!1,info:""}},methods:{getLastRun:function(e){var t=new Date(e);return t.getFullYear()+"."+(t.getMonth()+1)+"."+t.getDate()+" "+t.getHours()+":"+t.getMinutes()},saveNodeDescription:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n={description:e.$G.current_node.description},t.next=4,u.a.post("/api/v2/nodes/".concat(e.$G.current_node._id,"/settings/description"),n);case 4:t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),e.info="Description saved";case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))()},saveScript:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,u.a.put("/api/v2/nodes/".concat(t.$G.current_node._id,"/scripts/").concat(e),{js:t.$G.current_node.scripts[e]});case 3:t.info="Saved!",n.next=9;break;case 6:n.prev=6,n.t0=n["catch"](0),t.info="Save failed "+n.t0;case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))()},revertScript:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,u.a.put("/api/v2/nodes/".concat(t.$G.current_node._id,"/scripts/").concat(e,"/revert"));case 3:r=n.sent,t.$G.current_node.scripts[e]=r.data,t.info="Reverted!",n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](0),t.info="Revert failed";case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))()},initTab:function(){this.info=""},editorInit:function(e){this.info="",e.setFontSize(16),n("2099"),n("be9d"),n("bb36"),n("0329"),n("79fb"),n("6a21")}}},P=q,D=(n("6d77"),Object(b["a"])(P,G,x,!1,null,"4dc7d3d4",null)),F=D.exports,A=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.data&&e.$G.current_collection?n("div",[n("div",[n("b-sidebar",{attrs:{id:"sidebar-1",title:"Debug",shadow:""}},[n("div",{staticClass:"px-3 py-2"},[n("p",[e._v(" store.visible: "+e._s(e.$store.state.visible)+" ")]),n("p",[e._v(" $G.visible_fields: "+e._s(e.$G.visible_fields)+" ")]),n("p",[e._v(" $G.user.user: "+e._s(e.$G.user.user)+" ")]),e.$store.state.running_node?n("p",[e._v(" $store.state.running_node: "+e._s(e.$store.state.running_node.title)+" ")]):e._e(),e.$G.running_node?n("p",[e._v(" $G.running_node: "+e._s(e.$G.running_node.title)+" ")]):e._e()])])],1),n("div",[n("div",{staticClass:"data-header"},[n("h5",{staticClass:"float-left data-title"},[e.filter_query_badge?n("span",[e._v("[Filtered]")]):e._e(),e._v(" Documents of "+e._s(e.$G.current_collection.title)+" ("+e._s(e.data.total)+") "),n("b-navbar-toggle",{attrs:{target:"nav-table"}},[n("b-icon",{attrs:{icon:"gear-fill",variant:"primary",title:"select visible fields"}})],1),n("b-navbar-toggle",{attrs:{target:"nav-search"}},[n("b-icon",{attrs:{icon:"search",variant:"primary",title:"search"}})],1)],1),e.data&&0!=e.data.total?n("b-pagination-nav",{attrs:{size:"sm",align:"right","link-gen":e.linkGen,"number-of-pages":e.pageCount,"use-router":"","first-number":"","last-number":""}}):e._e()],1),n("b-collapse",{attrs:{id:"nav-table","is-nav":""},on:{shown:e.populateTabs}},[e.schema?n("b-container",{staticClass:"bv-example-row mb-3"},[n("b-button",{on:{click:function(t){return e.uncheck()}}},[e._v("uncheck all")]),n("b-row",{attrs:{cols:"3"}},[e._l(e.schema.keys,(function(t){return[e.checkLabelOutputGen(t)?n("b-col",{key:t},[n("b-form-checkbox",{attrs:{value:t},model:{value:e.selected_fields,callback:function(t){e.selected_fields=t},expression:"selected_fields"}},[n("b-badge",{attrs:{variant:"success",title:"node output field"}},[e._v(e._s(t))])],1)],1):e.checkLabelInputGen(t)?n("b-col",{key:t},[n("b-form-checkbox",{attrs:{value:t},model:{value:e.selected_fields,callback:function(t){e.selected_fields=t},expression:"selected_fields"}},[n("b-badge",{attrs:{title:"node input field"}},[e._v(e._s(t))])],1)],1):n("b-col",{key:t},[n("b-form-checkbox",{attrs:{value:t},model:{value:e.selected_fields,callback:function(t){e.selected_fields=t},expression:"selected_fields"}},[e._v(e._s(t))])],1)]}))],2)],1):e._e()],1),n("b-collapse",{attrs:{id:"nav-search","is-nav":""},on:{shown:e.populateTabs}},[n("b-row",[e.schema?n("b-col",[n("b-form-select",{attrs:{options:e.schema.keys},model:{value:e.query_key,callback:function(t){e.query_key=t},expression:"query_key"}})],1):e._e(),n("b-col",[n("b-form-select",{attrs:{options:e.query_type_list},model:{value:e.query_type,callback:function(t){e.query_type=t},expression:"query_type"}})],1),n("b-col",[n("b-form-input",{model:{value:e.query_value,callback:function(t){e.query_value=t},expression:"query_value"}})],1)],1),n("b-button",{on:{click:function(t){return e.loadData()}}},[e._v("Search")])],1),n("h5",[e.filter_query_badge?n("b-badge",[e._v(e._s(e.filter_query_badge)+" "),n("b-icon",{staticClass:"pointer",attrs:{icon:"x-circle"},on:{click:function(t){return e.resetSearch()}}})],1):e._e()],1),e.data&&0==e.data.total&&""==this.query_value?n("div",{staticClass:"alert alert-info"},[e._v("No documents found from collection! "),n("br"),n("b-icon",{attrs:{icon:"arrow-left"}}),e._v(" Start importing data by clicking plus sign in "),n("b",[e._v('"Read data"')]),e._v(". ")],1):n("b-table",{attrs:{small:"",striped:"","no-local-sorting":!0,items:e.data.data,fields:e.table_fields},on:{"sort-changed":e.sortingChanged},scopedSlots:e._u([{key:"head()",fn:function(t){return[e.checkLabelInput(t.label)?n("span",{staticClass:"text-primary"},[n("b-badge",[e._v(e._s(t.label))])],1):e.checkLabelOutput(t.label)?n("span",{staticClass:"text-primary"},[n("b-badge",{attrs:{variant:"success"}},[e._v(e._s(t.label))])],1):n("span",{staticClass:"text-primary"},[e._v(e._s(t.label))])]}},{key:"cell(action)",fn:function(t){return[e.$G.showNodeSettings?n("div",[e.$G.running_single!==t.item._id?n("div",{attrs:{title:"Run for this document"},on:{click:function(n){return e.$parent.runNodeSingle(t.item._id)}}},[n("b-button",{attrs:{variant:"primary"}},[n("b-icon",{attrs:{icon:"play"}}),e._v(e._s(t.value))],1)],1):n("div",{attrs:{title:"Run for this document"},on:{click:function(n){return e.$parent.runNodeSingle(t.item._id)}}},[n("b-button",{attrs:{variant:"primary"}},[e._v("running...")])],1)]):e._e()]}},{key:"cell()",fn:function(t){return[n("div",{domProps:{innerHTML:e._s(e.renderCell(t.value))}})]}}],null,!1,2730999224)})],1)]):e._e()},T=[],E=n("2909"),L=(n("6062"),n("3ca3"),n("4e82"),n("466d"),{name:"GPdataTable",data:function(){return{collection:"",current_fields:[],data:null,dataStart:0,dataLimit:15,filter_query_badge:"",initted:!1,node_settings:{},pageCount:1,sort:null,selected_fields:[],table_fields:[],query_key:"",query_type:"_regex_:",query_type_list:[{text:"is exactly",value:""},{text:"contains",value:"_regex_:"}],query_value:"",schema:null,maxArrayLenghtDisplay:10}},computed:{visible:{get:function(){return this.$store.state.visible},set:function(e){console.log("setting visible"),this.$store.dispatch("visible",e)}}},watch:{selected_fields:function(){this.current_fields=this.selected_fields,u.a.put("/api/v2/user/fields",{collection:this.$route.query.collection,fields:this.selected_fields})},current_fields:function(){this.table_fields=[],!this.$G.current_node||"process"!=this.$G.current_node.type&&"export"!=this.$G.current_node.type||this.table_fields.push({key:"action",label:"action",sortable:!1}),this.table_fields=this.table_fields.concat(this.current_fields.map((function(e){return{key:e,label:e,sortable:!0}}))),this.loadData()},$route:function(e,t){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:e.query.collection!=t.query.collection&&n.setFields(),n.query_field="",n.query_value="",n.query_key="",n.loadData();case 5:case"end":return r.stop()}}),r)})))()},"$G.current_node":function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.current_fields=[],!e.$G.current_node||"process"!=e.$G.current_node.type&&"export"!=e.$G.current_node.type){t.next=7;break}return t.next=4,e.getNodeFields(e.$G.current_node);case 4:e.current_fields=t.sent,t.next=8;break;case 7:e.current_fields=e.selected_fields;case 8:case"end":return t.stop()}}),t)})))()},"$store.state.running_node":function(){this.$G.running_node||this.loadData()}},methods:{checkLabelInput:function(e){if(this.$G.current_node&&this.$G.current_node.input.includes(e))return!0},checkLabelOutput:function(e){if(this.$G.current_node&&this.$G.current_node.output.includes(e))return!0},checkLabelOutputGen:function(e){if(this.$G.output_fields&&this.$G.output_fields.includes(e))return!0},checkLabelInputGen:function(e){if(this.$G.input_fields&&this.$G.input_fields.includes(e))return!0},getNodeFields:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=[],!e){n.next=8;break}return e.output&&(r=r.concat(e.output)),e.input&&(r=r.concat(e.input)),n.next=6,t.getUserFields();case 6:return o=n.sent,n.abrupt("return",Object(E["a"])(new Set([].concat(Object(E["a"])(r),Object(E["a"])(o)))));case 8:case"end":return n.stop()}}),n)})))()},getUserFields:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadSchema();case 2:return t.next=4,e.$G.getUserFields(e.$route.query.collection);case 4:return n=t.sent,r=n.filter((function(t){return e.schema.keys.includes(t)})),r&&0!=n.length||(n=e.schema.keys.filter((function(t){return e.defaultField(t)&&!t.includes("__lang")})),u.a.put("/api/v2/user/fields",{collection:e.$route.query.collection,fields:n})),t.abrupt("return",Object(E["a"])(new Set(r)));case 8:case"end":return t.stop()}}),t)})))()},setFields:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getUserFields();case 2:n=t.sent,e.selected_fields=n,e.current_fields=n,e.table_fields=n.map((function(e){return{key:e,label:e,sortable:!0}}));case 6:case"end":return t.stop()}}),t)})))()},loadData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n="",e.query_value&&e.query_key?(n="&".concat(e.query_key,"=").concat(e.query_type).concat(e.query_value),r=e.query_type_list.find((function(t){return t.value==e.query_type})),e.filter_query_badge="SEARCH: ".concat(e.query_key," ").concat(r.text," ").concat(e.query_value)):e.filter_query_badge="",o="",e.sort&&(o="&sort=".concat(e.sort.sortBy,"&reverse=").concat(e.sort.sortDesc?"1":"0")),e.collection==e.$route.query.collection){t.next=7;break}return t.next=7,e.loadSchema();case 7:return e.collection=e.$route.query.collection,e.$route.query.page?e.dataStart=parseInt(e.$route.query.page)*e.dataLimit-e.dataLimit:e.dataStart=0,t.next=11,u()("/api/v2/collections/".concat(e.$route.query.collection,"/docs?skip=").concat(e.dataStart,"&keys=").concat(e.current_fields.join(",")).concat(o).concat(n));case 11:i=t.sent,e.data=i.data,e.pageCount=Math.ceil(e.data.total/e.dataLimit),0===e.pageCount&&(e.pageCount=1),e.initted=!0;case 16:case"end":return t.stop()}}),t)})))()},loadSchema:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u()("/api/v2/collections/".concat(e.$route.query.collection,"/schema"));case 2:n=t.sent,e.schema=n.data;case 4:case"end":return t.stop()}}),t)})))()},renderCell:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o="";if(null==e)return"<div></div>";if(this.editMode&&(n+=" edit"),Array.isArray(e))for(var i=0;i<e.length;i++)Array.isArray(e[i])?o+="<div data-index='"+i+"' class='object-cell'>["+i+"] array</div>":o+=this.renderCell(e[i],i,n,r);else"string"==typeof e||"number"==typeof e||null===e?"string"==typeof e&&e.match(/^http/)&&!this.editMode?o+=0===t||t?"<div class='"+n+"'>["+t+"] <a target='_blank' href='"+e+"'>"+e+"</a></div>":"<div class='"+n+"'> <a target='_blank' href='"+e+"'>"+e+"</a></div>":"string"==typeof e&&e.match(/<img src/)&&!this.editMode?o=e:"string"==typeof e&&e.match("^AAAA_error")?(e=e.replace("AAAA_error:",""),o+=null!=t?"<div class='error'>["+t+"] "+this.nl2br(e)+"</div>":"<div class='error'>"+this.nl2br(e)+"</div>"):o+="number"==typeof e?null!=t?"<div class='error'>["+t+"] "+e+"</div>":"<div class='error'>"+e+"</div>":null!=t?"<div class='"+n+"'>["+t+"] "+this.nl2br(e,r)+"</div>":"<div class='"+n+"'>"+this.nl2br(e,r)+"</div>":(o+=null!=t?"<div data-index="+t+" class='object-cell'>["+t+"] "+this.nl2br(JSON.stringify(e,null,2),r)+" </div>":"<div class='object-cell'>"+this.nl2br(JSON.stringify(e,null,2),r)+" ...</div>",o+="<div class='object-string'>as string</div>");return o},populateTabs:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.loadSchema();case 1:case"end":return t.stop()}}),t)})))()},defaultField:function(e){return(e.includes("title")||e.includes("author")||e.includes("year")||e.includes("issued")||e.includes("date")||e.includes("url")||!!e.includes("pvm"))&&e},setUserFields:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("do not update");case 1:case"end":return e.stop()}}),e)})))()},linkGen:function(e){return 1===e?"?collection=".concat(this.$route.query.collection):"?collection=".concat(this.$route.query.collection,"&page=").concat(e)},uncheck:function(){this.selected_fields=["_id"]},sortingChanged:function(e){this.sort=e,this.loadData()},resetSearch:function(){this.query_value="",this.query_key="",this.loadData()},nl2br:function(e,t){if("string"===typeof e){"thumbnail_html"!==t&&(e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;")),e.length>1e3&&(e=e.substring(0,1e3)+"...<br><a class='expand' href='#'>show (not implemented)</a>\n\n");var n="<br />";return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+n+"$2")}return""}},created:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("TABLE created"),!this.$route.query.collection){e.next=6;break}return console.log("ROUTE on"),this.collection=this.$route.query.collection,e.next=6,this.setFields();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}),M=L,I=(n("45be"),n("714a"),Object(b["a"])(M,A,T,!1,null,"7a4b70a8",null)),B=I.exports,U={name:"GPProject",components:{GPprojectSidebar:w,GPdataTable:B,GPnodeRun:F},methods:{loadData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u()("/api/v2/projects/".concat(e.$route.params.id));case 2:n=t.sent,e.$store.commit("current_project",n.data);case 4:case"end":return t.stop()}}),t)})))()},getSettingsFromUI:function(){var e={};p()("#node-settings input.node-settings:not([type='checkbox']), #node-settings select.node-settings").each((function(){if(p()(this).attr("name")){var t=p()(this).attr("name").split("[");t.length>1?(e[t[0]]||(e[t[0]]=[])).push(p()(this).val()):e[p()(this).attr("name")]=p()(this).val()}})),p()("#node-settings  input.node-settings[type='checkbox']").each((function(){e[p()(this).attr("name")]=p()(this).is(":checked")}));var t=[];p()("#node-settings  input.node-settings-fields[type='checkbox']").each((function(){p()(this).is(":checked")&&t.push(p()(this).attr("name").replace("fields_",""))})),t.length&&(e.fields=t),p()("#node-settings  textarea.node-settings").each((function(){e[p()(this).attr("name")]=p()(this).val()})),this.$G.current_node.nodeid.includes("script")&&(e["js"]=this.$G.editorContent);var n=p()(".node-description-value").val();return n&&(e.node_description=n),e},runNode:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$store.commit("socket_error",null),e.$store.commit("running_node",e.$G.current_node),e.$store.commit("socket_finish",""),e.$store.commit("socket_error",""),n=e.getSettingsFromUI(),console.log(n),t.next=8,u.a.post("/api/v2/nodes/".concat(e.$store.state.running_node._id,"/start"),n);case 8:r=t.sent,console.log(r);case 10:case"end":return t.stop()}}),t)})))()},stopNode:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$G.running_node=!1;case 1:case"end":return t.stop()}}),t)})))()},runNodeSingle:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.$store.commit("socket_error",null),console.log("runNodeSingle"),t.$store.commit("running_node",t.$G.current_node),r=t.getSettingsFromUI(),t.$G.running_single=e,n.next=7,u.a.post("/api/v2/nodes/".concat(t.$G.current_node._id,"/run/").concat(e),r);case 7:console.log(r),t.$G.running_single=!1,t.$store.commit("running_node",null);case 10:case"end":return n.stop()}}),n)})))()}},created:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("loading project"),console.log("loading DONE");case 2:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},z=U,H=Object(b["a"])(z,r,o,!1,null,null,null);t["a"]=H.exports},"840f":function(e,t,n){},"85ec":function(e,t,n){},9786:function(e,t,n){},cbea:function(e,t,n){},e177:function(e,t,n){},ece9:function(e,t,n){"use strict";n("1bdd")},ef9c:function(e,t,n){}});
//# sourceMappingURL=app.2a428160.js.map